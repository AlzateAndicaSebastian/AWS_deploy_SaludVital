<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VitalApp - Sistema de Gesti√≥n M√©dica</title>
   
</head>
<body>
<div class="container">
    <header>
        <h1>üè• VitalApp</h1>
        <p class="subtitle">Sistema de Gesti√≥n M√©dica Integral</p>
        <div id="apiStatus" class="api-status">Conectando...</div>
    </header>

    <div class="crud-sections">
        <!-- Secci√≥n de Citas -->
        <div class="section">
            <h2>üìÖ Gesti√≥n de Citas</h2>
            <div class="form-group">
                <label for="paciente">Paciente:</label>
                <input type="text" id="paciente" placeholder="Nombre del paciente">
            </div>
            <div class="form-group">
                <label for="medico">M√©dico:</label>
                <input type="text" id="medico" placeholder="Nombre del m√©dico">
            </div>
            <div class="form-group">
                <label for="fecha">Fecha:</label>
                <input type="date" id="fecha">
            </div>
            <button onclick="agendarCita()">Agendar Cita</button>

            <div class="form-group" style="margin-top: 20px;">
                <h3>Consultar Diagn√≥stico</h3>
                <input type="text" id="consultaPaciente" placeholder="Paciente">
                <input type="date" id="consultaFecha" style="margin-top: 10px;">
                <button onclick="obtenerDiagnostico()" style="margin-top: 10px;">Consultar Diagn√≥stico</button>
            </div>

            <div id="resultadosCitas" class="results"></div>
        </div>

        <!-- Secci√≥n de Resultados M√©dicos -->
        <div class="section">
            <h2>üìä Resultados M√©dicos</h2>
            <div class="form-group">
                <label for="resultadoPaciente">Paciente:</label>
                <input type="text" id="resultadoPaciente" placeholder="Nombre del paciente">
            </div>
            <div class="form-group">
                <label for="examen">Tipo de Examen:</label>
                <select id="examen">
                    <option value="glucosa">Glucosa</option>
                    <option value="presion">Presi√≥n Arterial</option>
                    <option value="colesterol">Colesterol</option>
                    <option value="hemograma">Hemograma</option>
                </select>
            </div>
            <div class="form-group">
                <label for="valor">Valor:</label>
                <input type="number" id="valor" placeholder="Valor del examen">
            </div>
            <button onclick="agregarResultado()">Agregar Resultado</button>

            <div class="form-group" style="margin-top: 20px;">
                <h3>Consultar Resultados</h3>
                <input type="text" id="consultaResultados" placeholder="Paciente">
                <button onclick="obtenerResultados()" style="margin-top: 10px;">Ver Resultados</button>
            </div>

            <div id="resultadosMedicos" class="results"></div>
        </div>

        <!-- Secci√≥n de Alertas -->
        <div class="section">
            <h2>‚ö†Ô∏è Alertas de Salud</h2>
            <div class="form-group">
                <label for="alertaPaciente">Paciente:</label>
                <input type="text" id="alertaPaciente" placeholder="Nombre del paciente">
            </div>
            <button onclick="obtenerAlertas()">Ver Alertas</button>

            <div id="alertasSalud" class="results">
                <div class="alert info">
                    Las alertas se generan autom√°ticamente cuando los valores de los ex√°menes superan los umbrales establecidos.
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>VitalApp &copy; 2025 - Sistema DevOps para Gesti√≥n M√©dica</p>
    </footer>
</div>

<script>
    // Configuraci√≥n de la API
    const API_BASE_URL = 'https://18.215.183.193:10000';

    // Verificar estado de la API al cargar la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
        verificarEstadoAPI();
    });

    // Funci√≥n para verificar el estado de la API
    async function verificarEstadoAPI() {
        const statusElement = document.getElementById('apiStatus');
        try {
            const response = await fetch(`${API_BASE_URL}/`);
            const data = await response.json();

            if (data.status === 'active') {
                statusElement.textContent = '‚úÖ API Conectada';
                statusElement.className = 'api-status';
            } else {
                statusElement.textContent = '‚ùå API No Disponible';
                statusElement.className = 'api-status offline';
            }
        } catch (error) {
            statusElement.textContent = '‚ùå Error de Conexi√≥n';
            statusElement.className = 'api-status offline';
            console.error('Error conectando a la API:', error);
        }
    }

    // Funci√≥n para agendar cita
    async function agendarCita() {
        const paciente = document.getElementById('paciente').value;
        const medico = document.getElementById('medico').value;
        const fecha = document.getElementById('fecha').value;
        const resultadosDiv = document.getElementById('resultadosCitas');

        if (!paciente || !medico || !fecha) {
            mostrarResultado(resultadosDiv, 'Por favor complete todos los campos', 'error');
            return;
        }

        try {
            resultadosDiv.innerHTML = '<div class="loading">Agendando cita...</div>';

            const response = await fetch(`${API_BASE_URL}/citas`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    paciente: paciente,
                    medico: medico,
                    fecha: fecha
                })
            });

            const data = await response.json();

            if (response.ok) {
                mostrarResultado(resultadosDiv, `‚úÖ ${data.message}`, 'success');
                // Limpiar campos
                document.getElementById('paciente').value = '';
                document.getElementById('medico').value = '';
                document.getElementById('fecha').value = '';
            } else {
                mostrarResultado(resultadosDiv, `‚ùå Error: ${data.detail}`, 'error');
            }
        } catch (error) {
            mostrarResultado(resultadosDiv, `‚ùå Error de conexi√≥n: ${error.message}`, 'error');
        }
    }

    // Funci√≥n para obtener diagn√≥stico
    async function obtenerDiagnostico() {
        const paciente = document.getElementById('consultaPaciente').value;
        const fecha = document.getElementById('consultaFecha').value;
        const resultadosDiv = document.getElementById('resultadosCitas');

        if (!paciente || !fecha) {
            mostrarResultado(resultadosDiv, 'Por favor complete paciente y fecha', 'error');
            return;
        }

        try {
            resultadosDiv.innerHTML = '<div class="loading">Buscando diagn√≥stico...</div>';

            const response = await fetch(`${API_BASE_URL}/diagnosticos/${encodeURIComponent(paciente)}/${fecha}`);
            const data = await response.json();

            if (response.ok) {
                mostrarResultado(resultadosDiv, `üìã Diagn√≥stico para ${paciente} (${fecha}):<br><strong>${data.diagnostico}</strong>`, 'success');
            } else {
                mostrarResultado(resultadosDiv, `‚ùå ${data.detail}`, 'error');
            }
        } catch (error) {
            mostrarResultado(resultadosDiv, `‚ùå Error de conexi√≥n: ${error.message}`, 'error');
        }
    }

    // Funci√≥n para agregar resultado m√©dico
    async function agregarResultado() {
        // Nota: Esta funci√≥n simula agregar resultados ya que el endpoint no est√° expuesto
        // En un caso real, necesitar√≠as el endpoint correspondiente
        const paciente = document.getElementById('resultadoPaciente').value;
        const examen = document.getElementById('examen').value;
        const valor = document.getElementById('valor').value;
        const resultadosDiv = document.getElementById('resultadosMedicos');

        if (!paciente || !valor) {
            mostrarResultado(resultadosDiv, 'Por favor complete todos los campos', 'error');
            return;
        }

        // Simulaci√≥n - en un caso real har√≠as fetch al endpoint correspondiente
        mostrarResultado(resultadosDiv, `‚úÖ Resultado agregado para ${paciente}: ${examen} = ${valor}`, 'success');

        // Limpiar campos
        document.getElementById('resultadoPaciente').value = '';
        document.getElementById('valor').value = '';
    }

    // Funci√≥n para obtener resultados m√©dicos
    async function obtenerResultados() {
        // Nota: Esta funci√≥n es simulada ya que el endpoint no est√° expuesto
        const paciente = document.getElementById('consultaResultados').value;
        const resultadosDiv = document.getElementById('resultadosMedicos');

        if (!paciente) {
            mostrarResultado(resultadosDiv, 'Por favor ingrese el nombre del paciente', 'error');
            return;
        }

        // Simulaci√≥n de resultados
        const resultadosSimulados = [
            { examen: 'glucosa', valor: 95 },
            { examen: 'presion', valor: 120 }
        ];

        let html = `<h4>Resultados para ${paciente}:</h4>`;
        resultadosSimulados.forEach(result => {
            html += `<div class="alert ${result.valor > 110 ? 'warning' : 'success'}">${result.examen}: ${result.valor}</div>`;
        });

        resultadosDiv.innerHTML = html;
    }

    // Funci√≥n para obtener alertas
    async function obtenerAlertas() {
        const paciente = document.getElementById('alertaPaciente').value;
        const alertasDiv = document.getElementById('alertasSalud');

        if (!paciente) {
            mostrarResultado(alertasDiv, 'Por favor ingrese el nombre del paciente', 'error');
            return;
        }

        try {
            alertasDiv.innerHTML = '<div class="loading">Buscando alertas...</div>';

            const response = await fetch(`${API_BASE_URL}/alertas/${encodeURIComponent(paciente)}`);
            const data = await response.json();

            if (response.ok) {
                if (data.alertas && data.alertas.length > 0) {
                    let html = `<h4>Alertas para ${paciente}:</h4>`;
                    data.alertas.forEach(alerta => {
                        html += `<div class="alert warning">‚ö†Ô∏è ${alerta}</div>`;
                    });
                    alertasDiv.innerHTML = html;
                } else {
                    mostrarResultado(alertasDiv, `‚úÖ No hay alertas para ${paciente}`, 'success');
                }
            } else {
                mostrarResultado(alertasDiv, `‚ùå ${data.detail}`, 'error');
            }
        } catch (error) {
            mostrarResultado(alertasDiv, `‚ùå Error de conexi√≥n: ${error.message}`, 'error');
        }
    }

    // Funci√≥n auxiliar para mostrar resultados
    function mostrarResultado(element, mensaje, tipo) {
        element.innerHTML = `<div class="alert ${tipo}">${mensaje}</div>`;
    }
</script>
</body>
</html>
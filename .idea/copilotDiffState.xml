<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/managers/paciente_manager.py">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/managers/paciente_manager.py" />
              <option name="originalContent" value="import json&#10;import hashlib&#10;import os&#10;from datetime import datetime&#10;from app.config import obtener_archivo_paciente&#10;&#10;&#10;&#10;&#10;&#10;class PacienteManager:&#10;    def __init__(self, base_dir=None):&#10;        &quot;&quot;&quot;&#10;        Gestiona el registro y autenticación de pacientes.&#10;        base_dir permite aislar el almacenamiento (útil en tests).&#10;        &quot;&quot;&quot;&#10;        from app.config import BASE_DATA_DIR&#10;        self.base_dir = base_dir or BASE_DATA_DIR&#10;&#10;&#10;    def _hash_contraseña(self, contraseña: str) -&gt; str:&#10;        &quot;&quot;&quot;&#10;        Genera un hash de la contraseña para almacenarla de forma segura.&#10;        &quot;&quot;&quot;&#10;        return hashlib.sha256(contraseña.encode()).hexdigest()&#10;&#10;    def _guardar_paciente(self, datos_paciente: dict):&#10;        &quot;&quot;&quot;&#10;        Guarda los datos del paciente en un archivo JSON.&#10;        &quot;&quot;&quot;&#10;        archivo = obtener_archivo_paciente(datos_paciente[&quot;documento&quot;])&#10;        # No almacenamos la contraseña en texto plano&#10;        datos_a_guardar = datos_paciente.copy()&#10;        datos_a_guardar[&quot;contraseña&quot;] = self._hash_contraseña(datos_paciente[&quot;contraseña&quot;])&#10;        datos_a_guardar[&quot;fecha_registro&quot;] = datetime.now().isoformat()&#10;        &#10;        with open(archivo, &quot;w&quot;) as f:&#10;            json.dump(datos_a_guardar, f, indent=4)&#10;&#10;    def _cargar_paciente(self, documento: str) -&gt; dict:&#10;        &quot;&quot;&quot;&#10;        Carga los datos de un paciente desde su archivo JSON.&#10;        &quot;&quot;&quot;&#10;        archivo = obtener_archivo_paciente(documento)&#10;        if not os.path.exists(archivo):&#10;            return None&#10;&#10;        with open(archivo, &quot;r&quot;) as f:&#10;            return json.load(f)&#10;&#10;    def registrar_paciente(self, documento: str, nombre_completo: str, contraseña: str, &#10;                          telefono: str, email: str, edad: int, sexo: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Registra un nuevo paciente en el sistema.&#10;        &quot;&quot;&quot;&#10;        # Verificar si el paciente ya existe&#10;        if self._cargar_paciente(documento):&#10;            raise ValueError(&quot;Ya existe un paciente con ese documento&quot;)&#10;&#10;        # Crear diccionario con los datos del paciente&#10;        datos_paciente = {&#10;            &quot;documento&quot;: documento,&#10;            &quot;nombre_completo&quot;: nombre_completo,&#10;            &quot;contraseña&quot;: contraseña,&#10;            &quot;telefono&quot;: telefono,&#10;            &quot;email&quot;: email,&#10;            &quot;edad&quot;: self.verificar_edad(edad),&#10;            &quot;sexo&quot;: sexo&#10;        }&#10;&#10;        # Guardar paciente&#10;        self._guardar_paciente(datos_paciente)&#10;        return True&#10;&#10;    def verificar_edad(self, edad):&#10;        # verificamos que sea mayor de 18 años&#10;        try:&#10;            edad_int = int(edad)&#10;        except (TypeError, ValueError):&#10;            raise ValueError(&quot;Edad inválida&quot;)&#10;        if edad_int &lt; 18:&#10;            raise ValueError(&quot;Debe ser mayor de edad para registrarse&quot;)&#10;        return edad_int&#10;&#10;    def autenticar_paciente(self, documento: str, contraseña: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Autentica a un paciente verificando su documento y contraseña.&#10;        &quot;&quot;&quot;&#10;        paciente = self._cargar_paciente(documento)&#10;        if not paciente:&#10;            return False&#10;&#10;        hash_contraseña = self._hash_contraseña(contraseña)&#10;        return paciente.get(&quot;contraseña&quot;) == hash_contraseña&#10;&#10;    def obtener_datos_paciente(self, documento: str) -&gt; dict:&#10;        &quot;&quot;&quot;&#10;        Obtiene los datos de un paciente sin la contraseña.&#10;        &quot;&quot;&quot;&#10;        paciente = self._cargar_paciente(documento)&#10;        if paciente:&#10;            # Remover la contraseña antes de devolver los datos&#10;            paciente.pop(&quot;contraseña&quot;, None)&#10;            return paciente&#10;        return None&#10;&#10;    def existe_paciente(self, documento: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Verifica si un paciente está registrado en el sistema.&#10;        &quot;&quot;&quot;&#10;        return os.path.exists(obtener_archivo_paciente(documento))" />
              <option name="updatedContent" value="import json&#10;import hashlib&#10;import os&#10;from datetime import datetime&#10;from app.config import obtener_archivo_paciente&#10;&#10;&#10;&#10;&#10;&#10;class PacienteManager:&#10;    def __init__(self, base_dir=None):&#10;        &quot;&quot;&quot;&#10;        Gestiona el registro y autenticación de pacientes.&#10;        base_dir permite aislar el almacenamiento (útil en tests).&#10;        &quot;&quot;&quot;&#10;        from app.config import BASE_DATA_DIR&#10;        self.base_dir = base_dir or BASE_DATA_DIR&#10;&#10;&#10;    def _hash_contraseña(self, contraseña: str) -&gt; str:&#10;        &quot;&quot;&quot;&#10;        Genera un hash de la contraseña para almacenarla de forma segura.&#10;        &quot;&quot;&quot;&#10;        return hashlib.sha256(contraseña.encode()).hexdigest()&#10;&#10;    def _guardar_paciente(self, datos_paciente: dict):&#10;        &quot;&quot;&quot;&#10;        Guarda los datos del paciente en un archivo JSON.&#10;        &quot;&quot;&quot;&#10;        archivo = obtener_archivo_paciente(datos_paciente[&quot;documento&quot;])&#10;        # No almacenamos la contraseña en texto plano&#10;        datos_a_guardar = datos_paciente.copy()&#10;        datos_a_guardar[&quot;contraseña&quot;] = self._hash_contraseña(datos_paciente[&quot;contraseña&quot;])&#10;        datos_a_guardar[&quot;fecha_registro&quot;] = datetime.now().isoformat()&#10;        &#10;        with open(archivo, &quot;w&quot;) as f:&#10;            json.dump(datos_a_guardar, f, indent=4)&#10;&#10;    def _cargar_paciente(self, documento: str) -&gt; dict:&#10;        &quot;&quot;&quot;&#10;        Carga los datos de un paciente desde su archivo JSON.&#10;        &quot;&quot;&quot;&#10;        archivo = obtener_archivo_paciente(documento)&#10;        if not os.path.exists(archivo):&#10;            return None&#10;&#10;        with open(archivo, &quot;r&quot;) as f:&#10;            return json.load(f)&#10;&#10;    def registrar_paciente(self, documento: str, nombre_completo: str, contraseña: str, &#10;                          telefono: str, email: str, edad: int, sexo: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Registra un nuevo paciente en el sistema.&#10;        &quot;&quot;&quot;&#10;        # Verificar si el paciente ya existe&#10;        if self._cargar_paciente(documento):&#10;            raise ValueError(&quot;Ya existe un paciente con ese documento&quot;)&#10;&#10;        # Crear diccionario con los datos del paciente&#10;        datos_paciente = {&#10;            &quot;documento&quot;: documento,&#10;            &quot;nombre_completo&quot;: nombre_completo,&#10;            &quot;contraseña&quot;: contraseña,&#10;            &quot;telefono&quot;: telefono,&#10;            &quot;email&quot;: email,&#10;            &quot;edad&quot;: self.verificar_edad(edad),&#10;            &quot;sexo&quot;: sexo&#10;        }&#10;&#10;        # Guardar paciente&#10;        self._guardar_paciente(datos_paciente)&#10;        return True&#10;&#10;    def verificar_edad(self, edad):&#10;        # verificamos que sea mayor de 18 años&#10;        try:&#10;            edad_int = int(edad)&#10;        except (TypeError, ValueError):&#10;            raise ValueError(&quot;Edad inválida&quot;)&#10;        if edad_int &lt; 18:&#10;            raise ValueError(&quot;Debe ser mayor de edad para registrarse&quot;)&#10;        return edad_int&#10;&#10;    def autenticar_paciente(self, documento: str, contraseña: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Autentica a un paciente verificando su documento y contraseña.&#10;        &quot;&quot;&quot;&#10;        paciente = self._cargar_paciente(documento)&#10;        if not paciente:&#10;            return False&#10;&#10;        hash_contraseña = self._hash_contraseña(contraseña)&#10;        return paciente.get(&quot;contraseña&quot;) == hash_contraseña&#10;&#10;    def obtener_datos_paciente(self, documento: str) -&gt; dict:&#10;        &quot;&quot;&quot;&#10;        Obtiene los datos de un paciente sin la contraseña.&#10;        &quot;&quot;&quot;&#10;        paciente = self._cargar_paciente(documento)&#10;        if paciente:&#10;            # Remover la contraseña antes de devolver los datos&#10;            paciente.pop(&quot;contraseña&quot;, None)&#10;            return paciente&#10;        return None&#10;&#10;    def existe_paciente(self, documento: str) -&gt; bool:&#10;        &quot;&quot;&quot;&#10;        Verifica si un paciente está registrado en el sistema.&#10;        &quot;&quot;&quot;&#10;        return os.path.exists(obtener_archivo_paciente(documento))" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>